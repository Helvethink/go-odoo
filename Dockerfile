FROM golang:1.25@sha256:31c1e53dfc1cc2d269deec9c83f58729fa3c53dc9a576f6426109d1e319e9e9a AS builder

ARG PROJECT_NAME=generator
ARG PROJECT_PATH=generator
ARG TARGETPLATFORM
ARG BUILDPLATFORM
ARG TARGETOS
ARG TARGETARCH

WORKDIR /app/
COPY . .

RUN CGO_ENABLED=0 GOOS=${TARGETOS} GOARCH=${TARGETARCH} go build -ldflags="-w -s" -o ${PROJECT_PATH}/${PROJECT_NAME} ${PROJECT_PATH}/main.go

FROM alpine:3.23@sha256:25109184c71bdad752c8312a8623239686a9a2071e8825f20acb8f2198c3f659

ARG PROJECT_NAME=generator
ARG PROJECT_PATH=generator

WORKDIR /app/

COPY --from=builder /app/${PROJECT_PATH}/${PROJECT_NAME} /app/

ENTRYPOINT ["/app/generator"]
