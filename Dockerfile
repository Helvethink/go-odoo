FROM golang:1.26@sha256:c83e68f3ebb6943a2904fa66348867d108119890a2c6a2e6f07b38d0eb6c25c5 AS builder

ARG PROJECT_NAME=generator
ARG PROJECT_PATH=generator
ARG TARGETPLATFORM
ARG BUILDPLATFORM
ARG TARGETOS
ARG TARGETARCH

WORKDIR /app/
COPY . .

RUN CGO_ENABLED=0 GOOS=${TARGETOS} GOARCH=${TARGETARCH} go build -ldflags="-w -s" -o ${PROJECT_PATH}/${PROJECT_NAME} ${PROJECT_PATH}/main.go

FROM alpine:3.23@sha256:865b95f46d98cf867a156fe4a135ad3fe50d2056aa3f25ed31662dff6da4eb62

ARG PROJECT_NAME=generator
ARG PROJECT_PATH=generator

WORKDIR /app/

COPY --from=builder /app/${PROJECT_PATH}/${PROJECT_NAME} /app/

ENTRYPOINT ["/app/generator"]
