FROM golang:1.25@sha256:31c1e53dfc1cc2d269deec9c83f58729fa3c53dc9a576f6426109d1e319e9e9a AS builder

ARG PROJECT_NAME=generator
ARG PROJECT_PATH=generator
ARG TARGETPLATFORM
ARG BUILDPLATFORM
ARG TARGETOS
ARG TARGETARCH

WORKDIR /app/
COPY . .

RUN CGO_ENABLED=0 GOOS=${TARGETOS} GOARCH=${TARGETARCH} go build -ldflags="-w -s" -o ${PROJECT_PATH}/${PROJECT_NAME} ${PROJECT_PATH}/main.go

FROM alpine:3.23@sha256:51183f2cfa6320055da30872f211093f9ff1d3cf06f39a0bdb212314c5dc7375

ARG PROJECT_NAME=generator
ARG PROJECT_PATH=generator

WORKDIR /app/

COPY --from=builder /app/${PROJECT_PATH}/${PROJECT_NAME} /app/

ENTRYPOINT ["/app/generator"]
